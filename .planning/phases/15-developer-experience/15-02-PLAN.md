---
phase: 15-developer-experience
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - hive/templates/config.json
  - .claude/hive/templates/config.json
  - hive/references/git-integration.md
  - .claude/hive/references/git-integration.md
autonomous: true

must_haves:
  truths:
    - "The config template documents all three merge strategies (merge, squash, rebase) with usage guidance"
    - "The config template includes the auto_push field with false default"
    - "The git-integration reference explains when to use each merge strategy"
  artifacts:
    - path: "hive/templates/config.json"
      provides: "Config template with auto_push field and merge strategy documentation"
      contains: "auto_push"
    - path: "hive/references/git-integration.md"
      provides: "Merge strategy reference documentation"
      contains: "rebase"
  key_links:
    - from: "hive/templates/config.json"
      to: "loadConfig in hive-tools.js"
      via: "config.json template provides documented defaults that loadConfig reads"
      pattern: "auto_push|merge_strategy"
    - from: "hive/references/git-integration.md"
      to: "merge strategy selection"
      via: "reference document guides users on when to use merge/squash/rebase"
      pattern: "rebase|squash|merge.*strategy"
---

<objective>
Document merge strategies in config template and git-integration reference, and add auto_push to template.

Purpose: DX-03 ensures users understand when and how to use each merge strategy (merge, squash, rebase). Also completes DX-02 by adding auto_push to the config template.
Output: Updated config.json template with strategy guidance and auto_push, updated git-integration.md with strategy reference.
</objective>

<execution_context>
@./.claude/hive/workflows/execute-plan.md
@./.claude/hive/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@hive/templates/config.json
@hive/references/git-integration.md
@.planning/phases/14-multi-worker-safety/14-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add auto_push and merge strategy documentation to config template</name>
  <files>hive/templates/config.json, .claude/hive/templates/config.json</files>
  <action>
  Update `hive/templates/config.json` git section:

  1. Add `"auto_push": false` field after `"merge_strategy": "merge"` in the git section. This pairs with the loadConfig default added in Plan 01.

  2. The config template is a JSON file (no comments allowed in JSON), so strategy documentation goes through field naming and the reference doc. However, ensure the template clearly shows all available fields with sensible defaults:
     - `"merge_strategy": "merge"` (already exists) — valid values: "merge", "squash", "rebase"
     - `"auto_push": false` (new) — when true, pushes main to remote after dev-to-main merge

  **Sync installed copy:**
  Copy `hive/templates/config.json` to `.claude/hive/templates/config.json`.
  </action>
  <verify>
  Run `node -e "JSON.parse(require('fs').readFileSync('hive/templates/config.json','utf-8')); console.log('valid JSON')"` to confirm valid JSON.
  Run `grep "auto_push" hive/templates/config.json` to confirm field exists.
  </verify>
  <done>
  Config template has auto_push: false in git section.
  Template is valid JSON and synced to .claude/ copy.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add merge strategy reference documentation to git-integration.md</name>
  <files>hive/references/git-integration.md, .claude/hive/references/git-integration.md</files>
  <action>
  Add a new `<merge_strategies>` section to `hive/references/git-integration.md` after the existing `<commit_strategy_rationale>` section. This documents the three merge strategies available via `config.git.merge_strategy` and per-plan frontmatter `merge_strategy`:

  ```markdown
  <merge_strategies>

  ## Merge Strategy Guide

  Hive supports three merge strategies for integrating plan branches into dev (and dev into main). Set globally in `config.json` (`git.merge_strategy`) or per-plan in PLAN.md frontmatter (`merge_strategy`).

  **Precedence:** CLI `--strategy` flag > plan frontmatter > config > default ("merge")

  | Strategy | Command | History | Best For |
  |----------|---------|---------|----------|
  | `merge` (default) | `git merge --no-ff` | Preserves all commits + merge commit | Most projects — full history, easy bisect |
  | `squash` | `git merge --squash` | Single commit on target branch | Clean history when per-task commits are noise |
  | `rebase` | `git rebase` then fast-forward | Linear history, no merge commits | Linear-history teams, open source contribution style |

  ### merge (default, recommended)

  Creates a merge commit preserving per-task commit granularity on the target branch. Every `feat(XX-YY)` commit remains individually accessible via `git log`, `git bisect`, and `git blame`.

  **Use when:** You want full history (Hive's default and recommended approach — per-task commits are designed to be useful for AI context and debugging).

  ### squash

  Collapses all plan branch commits into a single commit on the target branch. Original commits remain on the plan branch until deleted.

  **Use when:** Per-task commits add noise (e.g., a plan that only tweaks config files), or the project prefers one-commit-per-PR style.

  **Trade-off:** Loses individual task attribution in target branch history. `git bisect` granularity reduced to plan level.

  ### rebase

  Replays plan branch commits on top of the target branch, creating a linear history without merge commits. Then fast-forwards the target branch.

  **Use when:** The project enforces linear history (no merge commits), or contributing to an open source project that requires rebase.

  **Trade-off:** Rewrites commit hashes. Plan branch becomes invalid after rebase. Not safe for shared branches (only use for single-worker plan branches).

  **Per-plan override example:**

  ```yaml
  # In PLAN.md frontmatter
  ---
  phase: 15-developer-experience
  plan: 01
  merge_strategy: squash    # Override global 'merge' for this plan only
  ---
  ```

  ### auto_push

  After dev-to-main merge on milestone completion, Hive can automatically push main to the remote:

  ```json
  {
    "git": {
      "auto_push": true
    }
  }
  ```

  **Default:** `false` (safe — user pushes manually). Set to `true` for CI/CD pipelines or when you always want to push after milestone completion.

  </merge_strategies>
  ```

  **Sync installed copy:**
  Copy `hive/references/git-integration.md` to `.claude/hive/references/git-integration.md` (with path substitution if needed).
  </action>
  <verify>
  Grep for "merge_strategies" in `hive/references/git-integration.md` to confirm section exists.
  Grep for "rebase" in `hive/references/git-integration.md` to confirm strategy is documented.
  Grep for "auto_push" in `hive/references/git-integration.md` to confirm push documentation.
  Diff source and installed copies to verify sync.
  </verify>
  <done>
  git-integration.md has merge_strategies section with guidance for merge, squash, and rebase.
  auto_push behavior documented with default and CI/CD guidance.
  Per-plan override example included.
  Installed copy (.claude/) synced.
  </done>
</task>

</tasks>

<verification>
1. config.json template has auto_push: false in git section
2. config.json template is valid JSON
3. git-integration.md has merge_strategies section
4. All three strategies (merge, squash, rebase) documented with trade-offs
5. auto_push documented with default behavior
6. Per-plan override example included
7. Both source and installed copies are in sync
</verification>

<success_criteria>
- Config template shows auto_push field so users discover it
- Merge strategy guidance helps users choose the right strategy
- Rebase documented with clear trade-offs and safety warnings
- No breaking changes to existing config (new field with safe default)
</success_criteria>

<output>
After completion, create `.planning/phases/15-developer-experience/15-02-SUMMARY.md`
</output>
