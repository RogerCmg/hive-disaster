---
phase: 04-feedback-loop
plan: "03"
type: execute
wave: 2
depends_on: ["04-01"]
files_modified:
  - commands/hive/insights.md
  - hive/workflows/insights.md
  - .claude/commands/hive/insights.md
  - .claude/hive/workflows/insights.md
autonomous: true

must_haves:
  truths:
    - "Running /hive:insights displays current project insights from INSIGHTS.md"
    - "/hive:insights offers to regenerate the digest when insights are stale or missing"
    - "After regeneration, updated insights are displayed"
  artifacts:
    - path: "commands/hive/insights.md"
      provides: "Slash command definition for /hive:insights"
      contains: "hive:insights"
    - path: "hive/workflows/insights.md"
      provides: "Insights workflow logic with display, staleness check, and regeneration"
      contains: "telemetry digest"
    - path: ".claude/commands/hive/insights.md"
      provides: "Installed copy of slash command"
      contains: "hive:insights"
    - path: ".claude/hive/workflows/insights.md"
      provides: "Installed copy of insights workflow"
      contains: "telemetry digest"
  key_links:
    - from: "commands/hive/insights.md"
      to: "hive/workflows/insights.md"
      via: "execution_context @reference"
      pattern: "workflows/insights.md"
    - from: "hive/workflows/insights.md"
      to: "hive-tools.js telemetry digest"
      via: "Bash command for regeneration"
      pattern: "telemetry digest"
---

<objective>
Create the /hive:insights slash command and its workflow to display current project insights, check for staleness, and offer digest regeneration.

Purpose: Gives users direct access to view project telemetry insights and regenerate the digest on demand, completing the user-facing portion of the feedback loop.
Output: New command file (commands/hive/insights.md) and workflow file (hive/workflows/insights.md) with installed copies.
</objective>

<execution_context>
@./.claude/hive/workflows/execute-plan.md
@./.claude/hive/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-feedback-loop/04-RESEARCH.md
@.planning/phases/04-feedback-loop/04-01-SUMMARY.md
@commands/hive/progress.md
@hive/workflows/progress.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create /hive:insights command file and workflow</name>
  <files>
commands/hive/insights.md
hive/workflows/insights.md
  </files>
  <action>
**1. Create the slash command file** at `commands/hive/insights.md` following the exact pattern from `commands/hive/progress.md`:

```markdown
---
name: hive:insights
description: Display current telemetry insights and offer to regenerate the digest
allowed-tools:
  - Read
  - Bash
  - Write
  - Glob
  - Grep
---
<objective>
Display current project telemetry insights, show pattern summary, check staleness, and offer to regenerate the digest.
</objective>

<execution_context>
@~/.claude/hive/workflows/insights.md
</execution_context>

<process>
Execute the insights workflow from @~/.claude/hive/workflows/insights.md end-to-end.
</process>
```

Note: The command file uses `~/.claude/` paths (source convention). The installed copy will use `./.claude/`.

**2. Create the workflow file** at `hive/workflows/insights.md` following the structure of `hive/workflows/progress.md`:

```markdown
<purpose>
Display current telemetry insights, show staleness, and offer to regenerate the digest.
</purpose>

<process>

<step name="load_insights">
Read `.planning/telemetry/INSIGHTS.md` if it exists.

If the file does NOT exist:
- Display: "No insights generated yet. No telemetry events have been analyzed."
- Display: "To generate insights, run: `node ./.claude/hive/bin/hive-tools.js telemetry digest`"
- Ask user: "Would you like to generate insights now?"
- If yes: run `node ./.claude/hive/bin/hive-tools.js telemetry digest` and then re-read and display the generated file.
- If no: end workflow.
</step>

<step name="display_insights">
If INSIGHTS.md exists, display its contents using Hive-branded formatting:

1. Show the header with generation timestamp (from the `*Generated:*` line)
2. Show the Event Summary table
3. Show the Agent Performance table
4. Show Recent Deviations
5. Show Tool Errors
6. Show Recommendations (if present)
7. Show Top Patterns (the recall markers content, formatted for human reading)

Use markdown formatting. Present the data clearly without modification.
</step>

<step name="staleness_check">
Check if insights are stale:

1. Extract the generation timestamp from INSIGHTS.md (`*Generated: {ISO date}*`)
2. Check if `.planning/telemetry/events.jsonl` exists and get its modification time
3. If events.jsonl was modified AFTER the INSIGHTS.md generation timestamp:
   - Display: "Insights may be outdated. New events have been recorded since the last digest."
   - Ask: "Would you like to regenerate the digest?"
4. If events.jsonl does NOT exist or is older than INSIGHTS.md:
   - Display: "Insights are up to date."
</step>

<step name="regenerate">
If the user requested regeneration:

1. Run: `node ./.claude/hive/bin/hive-tools.js telemetry digest`
2. Re-read the updated `.planning/telemetry/INSIGHTS.md`
3. Display the updated insights using the same format as step display_insights
4. Display: "Digest regenerated successfully."
</step>

</process>
```

Note: The workflow file uses `./.claude/` paths for hive-tools.js (the installed path). This is correct because workflows run from the project root.
  </action>
  <verify>
1. File exists: `ls commands/hive/insights.md hive/workflows/insights.md` shows both files
2. Command file has correct frontmatter: `head -5 commands/hive/insights.md` shows `name: hive:insights`
3. Workflow file references telemetry digest: `grep "telemetry digest" hive/workflows/insights.md` returns matches
4. Command file references workflow: `grep "insights.md" commands/hive/insights.md` returns the execution_context reference
  </verify>
  <done>Slash command file and workflow file created with display, staleness check, and regeneration logic. Command follows existing progress.md pattern.</done>
</task>

<task type="auto">
  <name>Task 2: Create installed copies of command and workflow</name>
  <files>
.claude/commands/hive/insights.md
.claude/hive/workflows/insights.md
  </files>
  <action>
**1. Create the installed command copy** at `.claude/commands/hive/insights.md`:
- Copy `commands/hive/insights.md` to `.claude/commands/hive/insights.md`
- Change the `@~/.claude/hive/workflows/insights.md` path reference to `@./.claude/hive/workflows/insights.md` (installed convention uses relative `./.claude/` paths)

**2. Create the installed workflow copy** at `.claude/hive/workflows/insights.md`:
- Copy `hive/workflows/insights.md` to `.claude/hive/workflows/insights.md`
- The workflow already uses `./.claude/` paths for hive-tools.js, so it should be identical to the source.
- If there are any `~/.claude/` references in the workflow, change them to `./.claude/`.

**3. Verify both installed copies exist** and contain the correct path convention.

The convention in this codebase:
- Source files (`commands/hive/`, `hive/workflows/`): use `~/.claude/` paths for cross-references
- Installed files (`.claude/commands/hive/`, `.claude/hive/workflows/`): use `./.claude/` paths for cross-references
  </action>
  <verify>
1. Files exist: `ls .claude/commands/hive/insights.md .claude/hive/workflows/insights.md` shows both
2. Installed command uses `./.claude/` path: `grep "./.claude/" .claude/commands/hive/insights.md` returns match
3. Source command uses `~/.claude/` path: `grep "~/.claude/" commands/hive/insights.md` returns match
4. Installed workflow references hive-tools.js correctly: `grep "hive-tools.js" .claude/hive/workflows/insights.md` returns match
  </verify>
  <done>Installed copies of insights command and workflow exist at .claude/ paths with correct path conventions. /hive:insights is available to users immediately.</done>
</task>

</tasks>

<verification>
1. `/hive:insights` command is available: `ls commands/hive/insights.md .claude/commands/hive/insights.md` both exist
2. Workflow exists: `ls hive/workflows/insights.md .claude/hive/workflows/insights.md` both exist
3. Command references workflow correctly (source and installed paths differ appropriately)
4. Workflow includes staleness check and regeneration logic
5. Pattern matches existing command/workflow pairs (progress.md structure)
</verification>

<success_criteria>
- /hive:insights command file exists at commands/hive/insights.md and .claude/commands/hive/insights.md
- Insights workflow exists at hive/workflows/insights.md and .claude/hive/workflows/insights.md
- Command displays INSIGHTS.md content when it exists
- Command offers to generate when INSIGHTS.md is missing
- Command checks staleness and offers regeneration
- Source uses ~/.claude/ paths, installed uses ./.claude/ paths
</success_criteria>

<output>
After completion, create `.planning/phases/04-feedback-loop/04-03-SUMMARY.md`
</output>
